# Методология A/B теста: Маркетплейс, позиция рекламы

## Обзор проекта

**Цель:** Определить, влияет ли изменение позиции рекламного блока на ключевые метрики маркетплейса (конверсию, ARPU).

**Гипотеза:** Перемещение рекламного блока выше на странице приведёт к увеличению добавлений в корзину и выручки.

**Период:** 24-30 июля 2024 (7 дней)

**Размер выборки:** 401,260 уникальных пользователей (50/50 split)

---

## 1. Дизайн теста

### A/B Группы
- **Control** — оригинальная позиция рекламы (текущее состояние)
- **Test** — рекламный блок поднят выше на странице

### Randomization
- Рандомизация на уровне **пользователя** (user-level split)
- 50/50 распределение между группами
- Случайная выборка из потока пользователей

### Metrics

#### Первичная метрика
**CR_add (Conversion Rate: добавления)**
```
CR_add = (Уникальные пользователи с добавлениями) / (Всего уникальные пользователи)
```
Рассчитывается как процент пользователей, которые добавили товар в корзину.

#### Вторичные метрики
- **CTR** (Click-Through Rate) — процент пользователей, которые кликнули на рекламу
- **ARPU** (Average Revenue Per User) — средняя выручка на одного пользователя
- **ARPPU** (Average Revenue Per Paying User) — средняя выручка на покупающего пользователя
- **Conversion funnel** — полная воронка от просмотра к заказу

---

## 2. Статистический анализ

### Размер выборки и MDE

**Minimum Detectable Effect (MDE):** 2.5%

Базовая конверсия в контрольной группе: ~2.8%, требуется увеличение на 2.5% (до ~2.9%).

Статистическая мощность: **80%** (beta = 0.2)  
Уровень значимости: **α = 0.05** (двусторонний тест)

### Используемые тесты

#### 1. Chi-Square Test
Для проверки гипотезы о различии в **бинарных переменных** (добавил/не добавил):
```
H0: p_control = p_test
H1: p_control ≠ p_test
```

**Допущения:**
- Независимые наблюдения (разные пользователи)
- Достаточный размер ячеек (>5)
- Бинарные события

#### 2. Welch's t-test
Для проверки различий в **непрерывных переменных** (ARPU, выручка):
```
H0: μ_control = μ_test
H1: μ_control ≠ μ_test
```

**Преимущества:**
- Не требует равенства дисперсий
- Робастен к малым различиям в выборке

### Интерпретация p-value

- **p < 0.05** → результат **статистически значимый** ✅
- **0.05 ≤ p < 0.10** → результат **на грани значимости** ⚠️ (требует внимания)
- **p ≥ 0.10** → результат **НЕ значимый** ❌

---

## 3. Структура данных

### Raw данные (21 CSV файлов)
Исходные логи событий:
- `clientid` — уникальный пользователь
- `dt` — дата события
- `eventtype` — тип события (views, clicks, adds, orders)

### Обработанные данные (final_results_to_analyze.xlsx)
Агрегированные по пользователю и дате:

| clientid | dt | abgroup | views | clicks | adds | orders | revenue |
|----------|-----|---------|-------|--------|------|--------|---------|
| 111 | 2024-07-24 | control | 1 | 0 | 0 | 0 | 0 |
| 112 | 2024-07-24 | test | 1 | 1 | 1 | 1 | 250 |

---

## 4. Ключевые находки

### День 1 (24 июля)
- **CR_add:** +12.1% (p = 0.010) ✅ **ЗНАЧИМО**
- **ARPU:** +18.0% (p < 0.05) ✅ **ЗНАЧИМО**
- **Размер эффекта:** большой

### Дни 2-7
- **CR_add:** -1.1% (p ≈ 0.85) ❌ **НЕ значимо**
- **ARPU:** +4.6% (p ≈ 0.15) ❌ **НЕ значимо**
- **Размер эффекта:** отсутствует

### Полный период (7 дней)
- **CR_add:** +0.51% (p = 0.791) ❌ **НЕ значимо**
- **ARPU:** +6.3% (p = 0.054) ⚠️ **На грани**

---

## 5. Гипотезы объяснения

### Почему День 1 показал эффект?

1. **Эффект новизны** — новые пользователи более восприимчивы к изменениям
2. **Разные когорты** — День 1 = 67k пользователей, Дни 2-7 = 188k (3x больше)
3. **Launch boost** — специальная маркетинговая кампания в День 1
4. **Selection bias** — разные типы пользователей в разные дни

### Почему 90% не видят рекламу?

- Это **нормально для монетизационного контента**
- Реклама срабатывает только для активных пользователей
- Требуется **повышение видимости** (не изменение позиции)

---

## 6. Рекомендации

### ❌ НЕ рекомендуется
Изменение позиции рекламы не привело к значимому увеличению конверсии на полный период. **Гипотеза НЕ подтверждена.**

### ✅ Рекомендуется
1. **Когортный анализ** — изучить, почему День 1 показал эффект
2. **Сегментация** — анализ по типам пользователей (новые vs. постоянные)
3. **Повышение видимости** — работать над тем, чтобы 90% пользователей видели рекламу
4. **Дополнительные тесты** — размер рекламного блока, формат, контент

---

## 7. Технические детали

### Инструменты
- **Python** — анализ данных
- **Pandas** — обработка данных
- **SciPy** — статистические тесты
- **Matplotlib/Seaborn** — визуализация
- **Jupyter** — интерактивные ноутбуки

### Воспроизводимость
Весь код находится в `notebooks/`, все промежуточные данные в `data/processed/`.

Для повторного запуска:
```bash
# 1. Установить зависимости
pip install -r requirements.txt

# 2. Запустить анализ
jupyter notebook notebooks/
```

---

## 8. Лимитации и предположения

- **Предположение:** Рандомизация выполнена корректно
- **Лимитация:** 7-дневный период может быть недостаточен
- **Лимитация:** Возможны сезонные факторы
- **Контроль:** Нет данных о других маркетинговых кампаниях в этот период